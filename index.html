<html>

<head>
    <script src="node_modules/convnetjs/build/convnet.js"></script>
    <script src="src/main.js"></script>

</head>

<body>
    <div id="testArray">

    </div>
    <script>
        var createDivs = (testArray, results) => {
            var toBeRendered = testArray.map((data, index) => {
                return { data: data, result: results[index] };
            });

            var divs = toBeRendered.map((obj) => {
                let div = document.createElement("div");
                div.innerHTML = obj.data + " : " + obj.result;
                return div;
            });
            return divs;
        }

        var displayHeader = (headerString)=>{

            var headerLosing = document.createElement("h2");
            headerLosing.innerHTML = headerString;
            document.body.appendChild(headerLosing);

        }

        var displayTestDivs = (divs) => {

            divs.forEach(function (element) {
                document.body.appendChild(element);
            }, this);
        };

        var predictAndDisplayDataset = (net, dataSet, headerString, winningSet) => {
          var dataValue = (winningSet === true)? 1 : 0;
            let results = nim.predictDataSet(dataSet, net, dataValue);
            let divs = createDivs(dataSet.map(getArr), results);
            displayHeader( headerString);
            document.body.appendChild(createSummaryDiv(results, winningSet));
            displayTestDivs(divs, headerString);
        } 
        var getArr = obj=>obj.arr;
        var mean = (results) => {
            return results.reduce((sum, a) => sum + a, 0) / results.length;
        }
        var nrOfCorrect = function (results, winningSet) {
            return results.filter(function (result) {
                return (winningSet === true) ? result > 0.5 : result <= 0.5;
            }).length;
        };
        var totalNr = (results)=>results.length;
        var createSummaryDiv = (results, winningSet) => {
            let resultSummary = {
                nrCorrect: nrOfCorrect(results, winningSet),
                totalNr: totalNr(results),
                mean: mean(results)
            }
            var div = document.createElement("div");
            div.innerHTML += "-----Mean: " + resultSummary.mean + "-------<br>";
            div.innerHTML += "-----nrCorrect: " + resultSummary.nrCorrect + "------- of a total: " + resultSummary.totalNr;
            return div;
        }
        var network = nim.networks[0];
        var testDataWinning = nim.testData.filter(data=>data.value === 1);
        var testDataLosing = nim.testData.filter(data=>data.value === 0);
        predictAndDisplayDataset(network, nim.losingData, "TrainingData Losing", false);
        predictAndDisplayDataset(network, nim.winningData, "TrainingData Winning", true);
        predictAndDisplayDataset(network, testDataWinning, "Test data winning", true);
        predictAndDisplayDataset(network, testDataLosing, "Test data losing", false);
        window.setInterval(function(){
          location.reload()
            },5000);
    </script>
</body>

</html>
